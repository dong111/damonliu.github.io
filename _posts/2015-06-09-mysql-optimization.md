---
layout: post
category: db
title: MySQL 性能优化 - schema，索引，sql
tags: [mysql]
---

### 表和字段

设计表基本基于三大范式：
- 第一范式：数据库表的每一列都是不可分割的原子数据项
- 第二范式：要求实体的属性完全依赖于主关键字
- 第三范式：任何非主属性不依赖于其它非主属性

良好的逻辑设计和物理设计是高性能的基石，应该根据系统将要执行的语句来设计schema，这往往需要权衡各种因素。

#### 1. 数据类型选择的基本原则

- 更小的通常更好

    一般情况下，应该尽量使用可以正确存储数据的最小数据类型。例如只需要存储0-200，tinyint unsigned更好。更小
    的数据类型通常更快，因为它们占用更少的磁盘，内存和CPU缓存，处理起来需要的CPU时间也最短。
        
- 越简单的越好

    越简单的需要的CPU时间越短。例如整型比字符串操作代价更低，因为字符集和校队规则（排序规则）使字符串比整型比较
    更复杂，应该用datetime存储时间而不是字符串，用整型存储IP会更好。
        
- 尽量避免NULL

    很多表可以包含了NULL的列，应该NULL是列的默认属性，通常情况下最好指定列为NOT NULl，除非真的需要存储NULL值。
        
- 尽量使用相同的数据类型存储相似或相关的值
        
varchar(200) 和 varchar(20)的区别：更长的列会消耗更多的内存，因为MySQL通常会分配固定大小的内存块来保存内部值，
所以最好的策略是只分配真正需要的空间。

varchar(20) 和 char(20)的区别：varchar是变长的，char是定长的，会删除掉所有的末尾空格。

timestamp 和 datetime 的区别：timestamp只使用了datetime一般的存储空间，并且会根据时区的变化，具有自动更新的功能，
但是timestamp类型取值范围：1970-01-01 00:00:00 到 2037-12-31 23:59:59，long型存储的最大值。通常update_time字段
一般可以用timestamp表示，这样更新数据会自动更新时间。


#### 2. 主键的选取

- 整数类型
        整数通常是最好的主键选择，因为它们很快并且可以使用AUTO_INCREMENT。  
- ENUM 和 SET类型
        对于主键来说ENUM和SET类型通常是一个糟糕的选择，它们只适合存储固定信息，例如：人的性别。
- 字符串类型
        如果可能，应该避免使用字符串类型作为主键，因为它们很消耗空间，并且通常比整型慢，对于随机的字符串当做主键
        更要注意多加注意，例如MD5(),SHA1()或者UUID()产生的字符串，这些函数生成的新值会任意分布在很大的空间内，
        这会导致INSERT和一些SELECT语句变的很慢
                - 因为插入值会随机的写到索引的不同位置，所以使得INSERT语句很慢。
                - SELECT语句会很慢，因为逻辑上相邻的行会分布在磁盘和内存的不同地方。
                
### 索引

索引（MySQL中也称为key）是存储引擎用于快速找到记录的一种数据结构。
    
#### 1. 索引的类型


        
        